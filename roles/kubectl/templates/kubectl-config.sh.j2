#!/bin/bash

# 设置集群参数
"{{ BIN_PATH }}"kubectl config set-cluster kubernetes \
  --certificate-authority=/etc/kubernetes/cert/ca.pem \
  --embed-certs=true \
  --server="{{ KUBE_APISERVER }}" \
  --kubeconfig=kubectl.kubeconfig

# 设置客户端认证参数
"{{ BIN_PATH }}"kubectl config set-credentials admin \
  --client-certificate=/etc/kubernetes/cert/admin.pem \
  --client-key=/etc/kubernetes/cert/admin-key.pem \
  --embed-certs=true \
  --kubeconfig=kubectl.kubeconfig

# 设置上下文参数
"{{ BIN_PATH }}"kubectl config set-context kubernetes \
  --cluster=kubernetes \
  --user=admin \
  --kubeconfig=kubectl.kubeconfig
  
# 设置默认上下文
"{{ BIN_PATH }}"kubectl config use-context kubernetes --kubeconfig=kubectl.kubeconfig
